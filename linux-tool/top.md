# top

## 简介

top 程序提供了一个正在运行的动态实时视图系统。它可以显示系统摘要信息以及当前由 Linux 管理的进程或线程列表核心。显示的系
统摘要信息的类型和为进程显示的信息的类型、顺序和大小是所有用户可配置并且可以进行配置持续重启

## 全局命令

<style>
table th:first-of-type {
    width: 20%;
}
</style>

运行 top 后，最重要的两个命令是`h`(帮助)和`q`(退出)

| 按键   | 操作                                                                                                            |
| ------ | --------------------------------------------------------------------------------------------------------------- |
| h      | 显示帮助                                                                                                        |
| q      | 退出                                                                                                            |
| Up     | 向上                                                                                                            |
| Down   | 向下                                                                                                            |
| Left   | 向左                                                                                                            |
| Right  | 向右                                                                                                            |
| PgDn   | 下一页                                                                                                          |
| PgUp   | 上一页                                                                                                          |
| 0      | 是否忽略显示为零的值                                                                                            |
| A      | 切换显示全屏模式和交互式模式(按 g 可以在交互式模式中选择分组)                                                   |
| B      | 切换加粗显示数值                                                                                                |
| d \| s | 重新设置自动刷新时间(秒,整数)                                                                                   |
| E      | 切换摘要中的内存数据单位 (KiB、MiB、GiB 等)                                                                     |
| e      | 切换列表中的内存数据单位 (KiB、MiB、GiB 等)                                                                     |
| g      | 选取分组(交互式模式可用)                                                                                        |
| H      | 切换摘要中的线程显示                                                                                            |
| k      | 发送 kill 信号(需要手动输入进程 PID 和信号量)                                                                   |
| X      | 设置列表的列宽度(正整数,0 为默认,-1 表示自动)                                                                   |
| C      | 显示列表滚动信息                                                                                                |
| l      | 切换摘要的系统运行时间和系统负载显示和隐藏                                                                      |
| t      | 切换摘要中 CPU 使用率和进程的显示方式                                                                           |
| m      | 切换摘要中内存和交换空间的显示方式                                                                              |
| 1      | 切换摘要中 CPU 核心汇总展示和分开展示                                                                           |
| J      | 切换列表数值列对齐方式                                                                                          |
| j      | 切换列表字符列对齐方式                                                                                          |
| b      | 切换列表高亮展示方式                                                                                            |
| y      | 切换列表显示行高亮                                                                                              |
| x      | 切换列表显示列高亮                                                                                              |
| z      | 切换展示颜色                                                                                                    |
| c      | 切换列表展示完整的命令行                                                                                        |
| f \| F | 配置列表显示字段(上下箭头移动、右箭头选中、左箭头取消选中、s 设置排序字段、空格切换展示隐藏、q 或 `<Esc>` 退出) |
| u \| U | 筛选列表的用户 ID 或用户名 (如果留空则表示展示所有)                                                             |
| V      | 切换列表树形展示父子进程                                                                                        |
| i      | 切换列表显示全部进程或活动的进程                                                                                |
| n \| # | 设置列表一页显示多少个进程 (0 表示不限制)                                                                       |
| <      | 向左切换列表排序参考字段                                                                                        |
| \>     | 向右切换列表排序参考字段                                                                                        |
| R      | 切换列表升序或降序排序                                                                                          |
| L      | 查找列表中的字符                                                                                                |
| &      | 根据最近一次输入的查找条件继续找到列表中的下一个匹配项                                                          |
| o      | 按条件过滤列表，忽略大小写 (如输入`%CPU>5.0`、`%MEM<10.0`、`COMMAND=java`、`!COMMAND=python`等)                 |
| O      | 按条件过滤列表 (如输入`%CPU>5.0`、`%MEM<10.0`、`COMMAND=java`、`!COMMAND=python`等)                             |
| =      | 清除当前所有过滤列表条件                                                                                        |

> 所有等待输入确认的操作都可以通过按下`<Esc>`取消

## 选项

| 选项           | 说明                                                                                                 |
| -------------- | ---------------------------------------------------------------------------------------------------- |
| -d [secs]      | 指定界面刷新间隔时间 (秒,整数)                                                                       |
| -H             | 打开后进入线程查看模式                                                                               |
| -n [nums]      | 指定自动刷新`nums`次后自动退出                                                                       |
| -o [field]     | 指定参考`field`字段名来排序                                                                          |
| -O             | 展示`-o`选项支持的`field`字段名                                                                      |
| -p [pid]       | 过滤指定进程 ID 的程序，可以多次使用此选项                                                           |
| -u [uid\|user] | 过滤指定用户名或用户 ID 关联的进程 (用户必须是存在的)，在用户前加`!`表示排除，过滤非此用户关联的进程 |
| -c             | 默认展示完整的命令行                                                                                 |

## 摘要

进程列表上方为摘要，从上往下分别为

- 第一部分包括系统自最后一次启动以来运行的时间(时分秒、天)、当前登录用户数(users)、系统负载(1 分钟、5 分钟、15 分钟)
- 第二部分包括进程或线程统计、CPU 和内存使用率
  - 进程或线程包括总计(total)、运行中(running)、睡眠中(sleeping)、停止(stoped)、僵死(zombie)
  - CPU 使用率包括用户进程时间(us,user)、系统内核时间(sy,system)、调度优先级(ni,nice)、空闲内核时间(id,idle)、IO 等待时
    间(wa,io-wait)、time spent servicing hardware interrupts (hi)、time spent servicing software interrupts (si)、time
    stolen from this vm by the hypervisor (st)
  - 内存和交换空间使用率包括总计(total)、空闲(free)、已使用(used)、缓存(buff/cache)、可用(avail)

## 字段说明

以下为部分字段的简单说明

- _PID_ 进程 ID
- _USER_ 有效用户名
- _PR_ 进程优先级
- _NI_ CPU 调度优先级
- _VIRT_ 虚拟映像 (KiB)
- _RES_ 驻留大小 (KiB)
- _SHR_ 共享内存 (KiB)
- _S_ 进程状态
- _%CPU_ CPU 使用率
- _%MEM_ 内存使用率 (RES)
- _TIME+_ CPU 时间，百分之一
- _COMMAND_ 命令
- _PPID_ 父进程 PID
- _UID_ 有效用户 ID
- _GID_ 组 ID
- _GROUP_ 组名
- _PGRP_ 进程组 ID
- _TTY_ 伪终端
- _TPGID_ 伪终端进程组 ID
- _SID_ 会话 ID
- _nTH_ 线程数
- _P_ 上次使用的 CPU (SMP)
- _TIME_ CPU 时间
- _SWAP_ 交换大小 (KiB)
- _CODE_ 代码大小 (KiB)
- _DATA_ 数据+堆栈 (KiB)
- _nMaj_ 主要页面错误
- _nMin_ 次要页面错误
- _nDRT_ 脏页数
- _Flags_ 任务标志 <sched.h>
- _CGROUPS_ 控制组
- _SUPGIDS_ 支持组 ID
- _SUPGRPS_ 支持组名称
- _TGID_ 线程组 ID
- _ENVIRON_ 环境变量
- _vMj_ 主要故障增量
- _vMn_ 次要故障增量
- _USED_ 分辨率+交换大小 (KiB)

## 数据单位

- KiB = kibibyte = 1024 bytes
- MiB = mebibyte = 1024 KiB = 1,048,576 bytes
- GiB = gibibyte = 1024 MiB = 1,073,741,824 bytes
- TiB = tebibyte = 1024 GiB = 1,099,511,627,776 bytes
- PiB = pebibyte = 1024 TiB = 1,125,899,906,842,624 bytes
- EiB = exbibyte = 1024 PiB = 1,152,921,504,606,846,976 bytes

## 命令示例

1. 筛选进程 PID 为 0 的进程

   ```bash
   top -p 0
   ```

2. 只显示 smith 用户的进程

   ```bash
   top -u smith
   ```

3. 默认以内存使用率来排序且展示完整的命令行
   ```bash
   top -o %MEM -c
   ```

Last Modified 2021-07-12
