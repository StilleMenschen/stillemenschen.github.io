# grep

## 简介

搜索指定的输入文件（如果未指定文件或给定单个`'-'`连字符，则搜索标准输入），以查找包含与给定表达式匹配的行。 默认情况下
，`grep`打印匹配的行。另外还有另外两种与 grep 类似的命令，分别是`egrep`（grep -E）和`fgrep`（grep -F），`egrep`支持基本
和扩展的正则表达式，`fgrep`不支持正则表达式，按照字符串表面意思进行匹配。

```
grep [OPTIONS] PATTERN [FILE...]
grep [OPTIONS] [-e PATTERN | -f FILE] [FILE...]
```

## 选项

<style>
table th:first-of-type {
    width: 20%;
}
</style>

| 选项                         | 说明                                                                                                                                                          |
| :--------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| -i, --ignore-case            | 搜索时忽略大小写                                                                                                                                              |
| -c, --count                  | 取消正常的输出，只输出匹配行的数量                                                                                                                            |
| -v, --invert-match           | 显示不包含匹配文本的所有行                                                                                                                                    |
| -w, --word-regexp            | 匹配整词                                                                                                                                                      |
| -x, --line-regexp            | 匹配整行                                                                                                                                                      |
| -L, --files-without-match    | 仅输出未匹配到的文件名，在文件中匹配到第一个符合条件的数据后停止搜索                                                                                          |
| -l, --files-with-matches     | 仅输出匹配到的文件名，在文件中匹配到第一个符合条件的数据后停止搜索                                                                                            |
| -o, --only-matching          | 仅打印匹配行的匹配（非空）部分，每个这样的部分在单独的输出行上                                                                                                |
| -H, --with-filename          | 搜索多文件时显示文件名                                                                                                                                        |
| -h, --no-filename            | 搜索多文件时不显示文件名                                                                                                                                      |
| -n, --line-number            | 显示文件内匹配到的行号                                                                                                                                        |
| -r, --recursive              | 只有使用命令行执行时，才跟随符号链接递归搜索每个目录下的文件                                                                                                  |
| -R, --dereference-recursive  | 递归读取每个目录下的所有文件。 跟随所有符号链接                                                                                                               |
| --exclude=GLOB               | 排除指定的文件，支持通配符                                                                                                                                    |
| --exclude-dir=DIR            | 递归搜索时，排除指定的目录，支持通配符                                                                                                                        |
| --include=GLOB               | 包含指定的文件，支持通配符                                                                                                                                    |
| -E, --extended-regexp        | 将 PATTERN 解释为扩展的正则表达式                                                                                                                             |
| -P, --perl-regexp            | 将 PATTERN 解释为 Perl 的正则表达式                                                                                                                           |
| -A NUM, --after-context=NUM  | 在匹配行后打印 NUM 行尾随上下文。 在连续的匹配组之间放置包含组分隔符（在 --group-separator 下描述）的行                                                       |
| -B NUM, --before-context=NUM | 在匹配行之前打印前导上下文的 NUM 行。 在连续的匹配组之间放置包含组分隔符（在 --group-separator 下描述）的行                                                   |
| -C NUM, -NUM, --context=NUM  | 打印 NUM 行输出上下文。 在连续的匹配组之间放置包含组分隔符（在 --group-separator 下描述）的行                                                                 |
| --group-separator=SEP        | 使用 SEP 作为组分隔符。 默认情况下，SEP 是双连字符 (--)                                                                                                       |
| -m NUM, --max-count=NUM      | 在 NUM 匹配行后停止读取文件。 如果输入是来自常规文件的标准输入，并且输出 NUM 匹配行，则 grep 确保标准输入刚好位于退出前的最后匹配行，无论是否存在尾随上下文行 |
| --color[=C], --colour[=C]    | 为匹配到的字符着色，`C`的值为`never`，`always`或者`auto`                                                                                                      |

## 正则表达式

下面仅说明比较基本的用法，更加高级的用法自行搜索

> 在基本正则表达式中，元字符`?`，`+`，`{`，`|`，`(`和`)`失去其特殊含义；而是使用反斜杠版
> 本`\?`，`\+`，`\{`，`\|`，`\(`和`\)`

### 字符列表

在`[`和`]`包裹的字符表示可能出现的字符列表，支持连词表示，如`[a-e]`表示`[abcde]`，`\<`和`\>`表示单词开头和结尾，`\b`表示
以空格分隔的单词开头或结尾，`\B`表示非空格分隔的单词开头或结尾，`\w`表示`[0-9A-Za-z]`，`\W`表示`[^0-9A-Za-z]`

> 如果在`[`前面使用了`^`，则表示不包含，如`[^a-e]`表示不能包含字母`abcde`

### 开头结尾

`^`符号匹配开头，`$`符号匹配结尾

### 重复运算符

| 运算符 | 说明                                       |
| :----- | :----------------------------------------- |
| ?      | 指定前面的字符出现一次或零次               |
| \*     | 指定前面的字符出现零次或多次               |
| \+     | 指定签名档字符出现至少一次以上             |
| {n}    | 指定前面的字符出现 n 次                    |
| {n,}   | 指定前面的字符出现 n 次以上                |
| {,m}   | 指定前面的字符出现零次且最大出现 m 次      |
| {n,m}  | 指定前面的字符出现至少 n 次且最大出现 m 次 |

## 命令示例

> 当终端的字符编码为`UTF-8`的情况下，可以使用中文搜索

1. 输出当前目录下包含`abc`字符串的以`test`开头的所有文件和`/etc/hosts`文件

   ```bash
   grep abc test* /etc/hosts
   ```

2. 输出当前目录下`test`开头的所有文件中匹配`abc`字符串行的数量

   ```bash
   grep -c abc test*
   ```

3. 输出当前目录下`test`开头的所有文件中匹配`abc`字符串的行，并输出匹配行号

   ```bash
   grep -n abc test*
   ```

4. 输出当前目录下所有以`test`开头的文件中不包含匹配`abc`字符串的所有行，且不显示文件名

   ```bash
   grep -vh abc test*
   ```

5. 递归搜索当前目录和子目录中以`test`开头的所有文件中包含匹配`abc`字符串的行

   ```bash
   grep -r abc test*
   ```

6. 计算一个文件中的空行或非空的行的数量

   空行

   ```bash
   grep -c ^$ test.txt
   ```

   非空行

   ```bash
   grep -c -v ^$ test.txt
   ```

7. 查找 log 文件中 2021 年 1 月到 3 月且 1 号到 19 号的`error`级别的信息，同时忽略大小写

   ```bash
   grep -i '2021-0[1-3]-[01][0-9].* error ' main.log
   ```

8. 有时候只查找匹配的信息往往不够，可能还需要查找匹配行的前后几行

   ```bash
   ps -ef | grep -nA 1 [j]ava
   ps -ef | grep -nB 1 [j]ava
   grep -C 3 java app.log
   ```

9. 输出所有匹配的文件名和匹配的数量

   ```bash
   grep -H -c *
   ```

Last Modified 2025-06-26
