# iftop

## 简介

按主机显示网卡的带宽使用情况

```
iftop -h | [-nNpblP] [-u unit] [-i interface] [-f filter code] [-F net/mask] [-G net6/mask6]
```

## 命令

进入 iftop 后，可以通过按键命令操作显示信息

<style>
table th:first-of-type {
    width: 20%;
}
</style>

| 命令 | 说明                                                                       |
| :--- | :------------------------------------------------------------------------- |
| s    | 切换显示来源网络地址                                                       |
| d    | 切换显示目标网络地址                                                       |
| S    | 切换显示来源网络端口                                                       |
| D    | 切换显示目标网络端口                                                       |
| p    | 切换显示端口                                                               |
| N    | 切换端口解析为服务名                                                       |
| n    | 切换 DNS 域名解析                                                          |
| t    | 切换单个连接的显示方式，以不同的方式显示发送数据和接收数据的统计           |
| 1    | 按 2 秒内平均流量值排序                                                    |
| 2    | 按 20 秒内平均流量值排序                                                   |
| 3    | 按 40 秒内平均流量值排序                                                   |
| \>   | 参考目标地址排序                                                           |
| <    | 参考来源地址排序                                                           |
| l    | 输入一个 POSIX 拓展的正则表达式过滤，但不会影响最下方的总计                |
| P    | 切换暂停显示                                                               |
| o    | 切换冻结主机连接的显示顺序，如果有新的连接也不会显示出来，除非取消冻结顺序 |
| j    | 向上滚动，此操作在冻结顺序后非常有用                                       |
| k    | 向上滚动，此操作在冻结顺序后非常有用                                       |
| b    | 切换图形显示                                                               |
| B    | 切换图形刻度的统计平均值，2 秒/10 秒/40 秒                                 |
| T    | 显示每个主机连接的总计值                                                   |
| L    | 图形显示的比率                                                             |
| h/?  | 切换显示帮助                                                               |

## 选项

| 选项           | 说明                                                                        |
| :------------- | :-------------------------------------------------------------------------- |
| -h             | 显示帮助                                                                    |
| -n             | 不执行 DNS 域名解析                                                         |
| -N             | 不将端口号解析为服务名称                                                    |
| -p             | 以混杂模式运行，即使不是指定的网卡流量也会被统计                            |
| -P             | 显示网络端口                                                                |
| -l             | 显示来自本地链路地址的数据包                                                |
| -b             | 不显示图形                                                                  |
| -m             | 设置上方图形刻度的带宽上限值，支持的单位后缀 K/M/G，如 128K                 |
| -u             | 以指定的单位（每秒）显示带宽速率，支持 bit/bytes/packets                    |
| -i interface   | 监听指定网卡的数据流量                                                      |
| -f filter code | 使用指定的过滤代码来筛选流量，用于仅显示匹配特定模式的 IP 数据包            |
| -F net/mask    | 过滤指定网络地址，支持 CIDR 格式，如 10.3.0.0/255.255.0.0 或 192.168.0.0/16 |
| -G net6/mask6  | 过滤 IPv6 网络地址                                                          |
| -c             | 指定配置文件                                                                |
| -t             | 以文本数据方式输出到终端                                                    |
| -o 10s         | 指定排序方式 2s/10s/40s/source/destination                                  |

## 配置文件

<style>
table:nth-of-type(3) th:first-of-type {
    width: 50%;
}
</style>

配置文件以键值对的方式表示，如 interface: eth0

| 配置                                                   | 说明                                           |
| :----------------------------------------------------- | :--------------------------------------------- |
| interface: if                                          | 指定网卡                                       |
| dns-resolution: (yes\|no)                              | 是否通过 DNS 解析地址                          |
| port-resolution: (yes\|no)                             | 是否将端口解析为服务名                         |
| show-bars: (yes\|no)                                   | 是否显示图形                                   |
| promiscuous: (yes\|no)                                 | 是否开启混杂模式                               |
| port-display: (off\|source-only\|destination-only\|on) | 控制端口显示方式                               |
| link-local: (yes\|no)                                  | 是否显示本地链路地址                           |
| hide-source: (yes\|no)                                 | 是否隐藏显示来源地址                           |
| hide-destination: (yes\|no)                            | 是否隐藏显示目标地址                           |
| bandwidth-unit: (bits\|bytes\|packets)                 | 带宽单位                                       |
| sort: (2s\|10s\|40s\|source\|destination)              | 排序参考                                       |
| show-totals: (yes\|no)                                 | 是否显示每一个连接的总计                       |
| log-scale: (yes\|no)                                   | 图形显示的刻度                                 |
| max-bandwidth: bw                                      | 上方图形刻度的带宽上限值，支持的单位后缀 K/M/G |
| screen-filter: regexp                                  | 过滤器正则表达式                               |

## 命令示例

1. 显示网络流量但不解析主机名、端口名

   ```bash
   iftop -nNP
   ```

2. 显示指定网卡指定网络地址的流量并以 40 秒内的平均网络流量排序

   ```bash
   iftop -i br-f0d969d4a4x3 -o 40s -F 172.16.0.0/16
   ```

3. 使用过滤器仅显示 HTTP 流量

   ```bash
   iftop -f "tcp port 80"
   ```

Last Modified 2024-12-06
